import{r as v,j as e,Q as k,u as $}from"./index-vrnzen9p.js";import{c as O,a as D,z as w,u as F,t as H,I as T,B as E,L as R}from"./logo-QtqiQmPR.js";import{v as I}from"./v4-yQnnJER4.js";const z=O("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]),B=O("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),P=v.createContext(null),V=()=>{let a=v.useContext(P);if(!a)throw new Error("Child components of Modal cannot be rendered outside the Modal component!");return a},J=({children:a,onClose:o,isOpen:t})=>{const n=D("modal-wrapper",{open:t});return e.jsx("div",{className:n,children:e.jsx("div",{className:"modal-content",children:e.jsx(P.Provider,{value:{onClose:o},children:a})})})},U=({children:a,className:o,...t})=>{const n=D("flex justify-between items-center p-16",o),{onClose:u}=V();return e.jsxs("header",{className:n,...t,children:[e.jsx("h6",{className:"title",children:a}),e.jsx("div",{className:"button-close",onClick:()=>{u&&u()},children:e.jsx(B,{size:20})})]})},X=({children:a,className:o,...t})=>{const n=D("p-16",o);return e.jsx("footer",{className:n,...t,children:a})},Q=({children:a,className:o,...t})=>{const n=D("p-x-16",o);return e.jsx("div",{className:n,...t,children:a})},q=({children:a,...o})=>{const t=I();return e.jsxs("div",{children:[e.jsx("input",{id:t,type:"checkbox",...o}),e.jsx("label",{form:t,className:"m-l-6",children:a})]})},G=w.object({name:w.string().min(1,"Campo obrigatório"),email:w.string().email("E-mail inválido").min(1,"Campo obrigatório"),phone:w.string().min(1,"Campo obrigatório").regex(new RegExp("\\b[0-9]{10,11}\\b"),"Telefone inválido")}),y=[{label:"Todos",isChecked:!0},{label:"Honorários Sucumbenciais",isChecked:!0},{label:"Honorários Contratuais",isChecked:!0},{label:"Honorários Dativos",isChecked:!0},{label:"Crédito do Autor",isChecked:!0}],K={name:"",email:"",phone:""},W=({data:a,isOpen:o,onClose:t,createLead:n})=>{var f,L,b;const[u,d]=v.useState(y),{register:p,handleSubmit:m,setValue:l,formState:{errors:s}}=F({resolver:H(G),criteriaMode:"all",mode:"all",defaultValues:K});v.useEffect(()=>{l("name",a?a.name:""),l("email",a?a.email:""),l("phone",a?a.phone:""),d(a?y.map(h=>({...h,isChecked:a==null?void 0:a.opportunities.includes(h.label)})):y)},[a]);const i=h=>{const{name:N,checked:S}=h.target;if(N==="Todos")d(c=>c.map(j=>({...j,isChecked:S})));else{const c=[...u],j=c.findIndex(A=>A.label===N);u[0].isChecked&&(c[0]={...c[0],isChecked:!1}),c[j]={...c[j],isChecked:!c[j].isChecked},d(c)}},r=()=>{l("name",""),l("email",""),l("phone",""),d(y)},C=m(async({name:h,email:N,phone:S})=>{try{await n({name:h,email:N,phone:S,opportunities:u.filter(c=>c.isChecked).map(c=>c.label)}),t(),r(),k.success("Lead criado com sucesso")}catch(c){const{message:j}=c;k.error(j)}}),x=!!a;return e.jsxs(J,{isOpen:o,onClose:t,children:[e.jsx(U,{children:a?"Lead":"Novo Lead"}),e.jsxs(Q,{className:"flex flex-col justify-start gap-16",children:[e.jsx("div",{className:"flex flex-col gap-4",children:"Dados do Lead"}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{children:"Nome Completo: *"}),e.jsx(T,{...p("name"),className:"w-full",type:"text",error:!!s.name,helperText:(f=s==null?void 0:s.name)==null?void 0:f.message,disabled:x,placeholder:"Ex: Rodrigo Limões da Silva"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{children:"E-mail: *"}),e.jsx(T,{...p("email"),className:"w-full",type:"email",error:!!s.email,helperText:(L=s==null?void 0:s.email)==null?void 0:L.message,disabled:x,placeholder:"Ex: rodrigo@gmail.com"})]}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx("label",{children:"Telefone: *"}),e.jsx(T,{...p("phone"),className:"w-full",type:"text",error:!!s.phone,helperText:(b=s==null?void 0:s.phone)==null?void 0:b.message,disabled:x,placeholder:"Ex: 21987654327"})]}),e.jsxs("div",{className:"flex justify-start items-start flex-col gap-8",children:[e.jsx("strong",{children:"Oportunidades"}),e.jsx("div",{className:"flex flex-col gap-6",children:u.map((h,N)=>e.jsx(q,{name:h.label,checked:h.isChecked,onChange:i,disabled:x,children:h.label},`${h.label}-${N}`))})]})]}),e.jsx(X,{children:e.jsxs("div",{className:"w-full flex justify-end gap-6",children:[e.jsx(E,{variant:"outlined",color:"secondary",onClick:t,children:"Cancelar"}),e.jsx(E,{variant:"contained",color:"info",disabled:x,onClick:async()=>{await C()},children:"Salvar"})]})})]})},M=(a,o)=>o===g.PotentialClient&&a===g.ConfirmedData||o===g.ConfirmedData&&a===g.LeadAnalysis;var g=(a=>(a[a.PotentialClient=10]="PotentialClient",a[a.ConfirmedData=20]="ConfirmedData",a[a.LeadAnalysis=30]="LeadAnalysis",a))(g||{});const Y=()=>{const[a,o]=$("leads",[]),t=JSON.parse(window.localStorage.getItem("user")||""),n=({name:d,phone:p,email:m,opportunities:l})=>{const s={id:I(),name:d,email:m,opportunities:l,phone:p,userId:t?t.id:void 0,status:10};if(a.find(r=>r.email===m&&r.userId===(t==null?void 0:t.id)))throw new Error("O lead já existe");o(r=>[...r,s])},u=(d,p)=>{const m=[...a],l=m.findIndex(i=>i.id===d),s=m[l];if(M(p,s.status))m[l]={...s,status:p},o(m);else throw new Error("Não foi possivel alterar o status")};return{leads:a.filter(d=>d.userId===(t==null?void 0:t.id)),createLead:n,updateStatus:u}},Z=["Cliente em potencial","Dados confirmados","Análise do lead"],_=[g.PotentialClient,g.ConfirmedData,g.LeadAnalysis],ee=({leads:a,updateStatus:o,onViewLead:t})=>{const n=v.useRef(null),u=(s,{currentStatus:i,previousStatus:r})=>{s.preventDefault(),s.currentTarget.id!==(n==null?void 0:n.current)&&(M(i,r)?s.currentTarget.classList.add("drag-over-success"):s.currentTarget.classList.add("drag-over-error"))},d=s=>{s.preventDefault(),s.currentTarget.classList.remove("drag-over-error"),s.currentTarget.classList.remove("drag-over-success")},p=(s,{item:i,id:r})=>{s.dataTransfer.setData("id",r),s.dataTransfer.effectAllowed="move",n.current=i},m=async(s,{currentStatus:i,previousStatus:r})=>{var C,x,f,L;s.preventDefault(),(x=(C=s.currentTarget)==null?void 0:C.classList)==null||x.remove("drag-over-error"),(L=(f=s.currentTarget)==null?void 0:f.classList)==null||L.remove("drag-over-success");try{if(M(i,r)){const b=s.dataTransfer.getData("id");await o(b,i),k.success("Status atualizado com successo")}}catch(b){const{message:h}=b;k.error(h)}},l=a.map(s=>{const i=_.map((r,C)=>{const x=`${s.id}-${C}`;return e.jsx("td",{className:"text-center",id:x,onDragLeave:d,onDragOver:f=>{u(f,{currentStatus:r,previousStatus:s.status||g.PotentialClient})},onDrop:async f=>await m(f,{currentStatus:r,previousStatus:s.status||g.PotentialClient}),children:e.jsx("div",{className:`p-16 ${r!==s.status?"":"cursor-grab"}`,id:x,draggable:!0,onDragStart:f=>{r!==s.status?f.preventDefault():p(f,{item:x,id:(s==null?void 0:s.id)||""})},children:e.jsx("span",{onClick:()=>{t(s)},children:r===s.status?s.name:""})})},x)});return e.jsx("tr",{children:i},`${s.id}-${s.name}`)});return e.jsx("div",{className:"w-full m-t-12",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsx("tr",{children:Z.map(s=>e.jsx("th",{className:"p-16",children:s},s))})}),e.jsx("tbody",{children:l})]})})},se=()=>{const[a,o]=v.useState(!1),[t,n]=v.useState(void 0),{leads:u,createLead:d,updateStatus:p}=Y(),m=()=>{o(s=>!s),n(void 0)},l=s=>{o(i=>{const r=!i;return n(r?s:void 0),r})};return e.jsxs(e.Fragment,{children:[e.jsx(W,{isOpen:a,data:t,onClose:m,createLead:d}),e.jsx("div",{className:"w-full",children:e.jsx(E,{className:"float-right",variant:"contained",color:"info",icon:e.jsx(z,{}),onClick:m,children:"Novo Lead"})}),e.jsx(ee,{leads:u,updateStatus:p,onViewLead:l})]})},re=()=>e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"w-full h-152 p-16",children:e.jsx("img",{className:"w-full h-full",src:R,alt:"JusCash Logo"})}),e.jsx("main",{className:"w-full p-16 h-screen flex flex-col justify-start items-start",children:e.jsx(se,{})})]});export{re as default};
